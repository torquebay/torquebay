<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Torque Bay - Online Car Auctions</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&family=Montserrat:wght@700&display=swap" rel="stylesheet" />

  <style>
    /* Reset */
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: #1a1c20;
      color: #ccc;
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }

    /* Header */
    .top-header {
      background: #000;
      width: 100%;
      padding: 12px 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.7);
      position: relative;
      z-index: 1000;
      user-select: none;
    }

    .top-header .logo {
      max-width: 220px;
      cursor: pointer;
      filter: drop-shadow(0 3px 5px rgba(0,0,0,0.4));
      transition: filter 0.3s ease;
    }
    .top-header .logo:hover {
      filter: drop-shadow(0 6px 8px rgba(224,40,40,0.7));
    }
    .top-header .logo img {
      width: 100%;
      height: auto;
      background: transparent !important;
      display: block;
    }

    /* Navigation Bar */
    nav {
      width: 100%;
      background: rgba(20, 20, 24, 0.9);
      backdrop-filter: saturate(200%) blur(12px);
      display: flex;
      justify-content: center;
      gap: 48px;
      padding: 10px 0;
      position: sticky;
      top: 0;
      z-index: 999;
      font-weight: 600;
      font-size: 1rem;
      letter-spacing: 1.6px;
      user-select: none;
      border-top: 1px solid #3a3a3a;
      border-bottom: 1px solid #3a3a3a;
    }

    nav a {
      color: #bbb;
      text-decoration: none;
      padding-bottom: 4px;
      border-bottom: 3px solid transparent;
      transition: color 0.3s ease, border-color 0.3s ease;
    }
    nav a:hover,
    nav a:focus {
      color: #e02828;
      outline: none;
      border-bottom-color: #e02828;
    }
    nav a.active {
      color: #e02828;
      border-bottom-color: #e02828;
      pointer-events: none;
      cursor: default;
    }

    /* Centered welcome text */
    .welcome-text {
      text-align: center;
      margin: 40px 0 20px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      font-size: 2.8rem;
      color: #e02828;
      user-select: none;
      letter-spacing: 2px;
    }

    /* Layout */
    .container {
      max-width: 1100px;
      margin: 0 auto 80px;
      padding: 0 25px;
      display: flex;
      gap: 25px;
    }

    /* Sidebar filter */
    aside#filterSidebar {
      background: #272a2f;
      border-radius: 12px;
      padding: 20px 25px;
      width: 280px;
      color: #ccc;
      box-shadow: 0 0 12px rgba(0,0,0,0.4);
      user-select: none;
      flex-shrink: 0;
    }

    aside#filterSidebar h3 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      color: #e02828;
      margin-bottom: 20px;
      font-size: 1.3rem;
    }

    aside#filterSidebar label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 0.95rem;
      color: #ccc;
    }

    aside#filterSidebar input[type="text"],
    aside#filterSidebar select,
    aside#filterSidebar input[type="number"] {
      width: 100%;
      padding: 8px 10px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: none;
      background: #1a1c20;
      color: #eee;
      font-size: 1rem;
      box-shadow: inset 0 0 6px #000;
      transition: background-color 0.3s ease;
    }

    aside#filterSidebar input[type="text"]:focus,
    aside#filterSidebar select:focus,
    aside#filterSidebar input[type="number"]:focus {
      background-color: #2e3034;
      outline: none;
    }

    aside#filterSidebar button {
      width: 100%;
      padding: 12px;
      font-weight: 700;
      font-size: 1.1rem;
      border-radius: 6px;
      border: none;
      background-color: #e02828;
      color: #fff;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    aside#filterSidebar button:hover,
    aside#filterSidebar button:focus {
      background-color: #b62020;
      outline: none;
    }

    aside#filterSidebar button.clear-btn {
      background-color: #555;
      margin-top: 10px;
    }
    aside#filterSidebar button.clear-btn:hover,
    aside#filterSidebar button.clear-btn:focus {
      background-color: #444;
    }

    /* Listings container */
    main#listingsContainer {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    /* Listing card */
    .listing {
      background: #272a2f;
      border-radius: 12px;
      display: flex;
      gap: 20px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      color: #ddd;
      user-select: none;
    }

    .listing.ended {
      opacity: 0.6;
      pointer-events: none;
    }

    /* Gallery */
    .gallery {
      flex-shrink: 0;
      width: 280px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .gallery #mainImage {
      width: 280px;
      height: 160px;
      object-fit: cover;
      border-radius: 10px;
      cursor: zoom-in;
      transition: transform 0.3s ease;
      user-select: none;
      background: #000;
      box-shadow: 0 0 6px rgba(224,40,40,0.5);
    }
    .gallery #mainImage.zoomed {
      transform: scale(1.8);
      cursor: zoom-out;
      position: relative;
      z-index: 20;
      border: 2px solid #e02828;
    }

    .gallery .thumbs {
      display: flex;
      gap: 8px;
      overflow-x: auto;
    }

    .gallery .thumbs img {
      width: 60px;
      height: 40px;
      object-fit: cover;
      border-radius: 6px;
      cursor: pointer;
      border: 2px solid transparent;
      user-select: none;
      flex-shrink: 0;
      transition: border-color 0.3s ease;
    }
    .gallery .thumbs img.selected {
      border-color: #e02828;
    }

    /* Details */
    .details {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
      user-select: text;
    }

    .details h2 {
      font-family: 'Montserrat', sans-serif;
      font-size: 1.9rem;
      font-weight: 700;
      color: #e02828;
      margin-bottom: 6px;
      user-select: none;
    }

    .badges {
      display: flex;
      gap: 15px;
      font-weight: 600;
      font-size: 0.9rem;
      color: #a0a0a0;
      user-select: none;
    }

    .badge {
      background: #28a745;
      color: white;
      border-radius: 14px;
      padding: 5px 16px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      user-select: none;
    }

    .badge.not-runner {
      background: #cc2222;
    }

    .badge .tick {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid white;
      border-radius: 50%;
      position: relative;
    }

    .badge .tick::after {
      content: '';
      position: absolute;
      left: 3px;
      top: 0;
      width: 5px;
      height: 10px;
      border-right: 2.5px solid white;
      border-bottom: 2.5px solid white;
      transform: rotate(45deg);
    }

    /* Auction countdown */
    #auctionEnds {
      font-weight: 700;
      font-size: 1.15rem;
      color: #ccc;
      margin: 10px 0 20px;
      user-select: none;
    }

    /* Description */
    .description {
      font-size: 1rem;
      line-height: 1.5;
      color: #ccc;
      margin-bottom: 20px;
      user-select: text;
    }

    /* Actions */
    .actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .actions label {
      font-weight: 600;
      user-select: none;
      flex: 1 1 100%;
    }

    .actions input[type=number] {
      padding: 8px 10px;
      border-radius: 6px;
      border: none;
      background: #1a1c20;
      color: #eee;
      font-size: 1rem;
      width: 120px;
      box-shadow: inset 0 0 6px #000;
      user-select: text;
    }

    .actions button {
      cursor: pointer;
      font-weight: 700;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      user-select: none;
      font-size: 1rem;
      flex: 1 1 120px;
      transition: background-color 0.3s ease;
    }

    #bidBtn {
      background-color: #e02828;
      color: white;
    }
    #bidBtn:hover,
    #bidBtn:focus {
      background-color: #b62020;
      outline: none;
    }

    #buyNowBtn {
      background-color: #ff6f00;
      color: white;
    }
    #buyNowBtn:hover,
    #buyNowBtn:focus {
      background-color: #cc5c00;
      outline: none;
    }

    #contactSellerBtn {
      background-color: #28a745;
      color: white;
    }
    #contactSellerBtn:hover,
    #contactSellerBtn:focus {
      background-color: #218838;
      outline: none;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 20px 10px;
      font-weight: 300;
      font-size: 0.9rem;
      color: #555;
      user-select: none;
      border-top: 1px solid #2a2a2a;
      margin-top: auto;
      background: #121318;
    }

    /* Contact Modal */
    dialog#contactModal {
      border: none;
      border-radius: 8px;
      padding: 20px 25px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      font-family: Arial, Helvetica, sans-serif;
    }

    dialog#contactModal h2 {
      margin-top: 0;
      color: #e02828;
      user-select: none;
    }

    dialog#contactModal form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    dialog#contactModal label {
      font-weight: 700;
      user-select: none;
    }

    dialog#contactModal input[type=text],
    dialog#contactModal input[type=tel] {
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
      user-select: text;
    }

    dialog#contactModal button {
      margin-top: 15px;
      padding: 12px 0;
      font-weight: 700;
      font-size: 1rem;
      background-color: #e02828;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    dialog#contactModal button:hover,
    dialog#contactModal button:focus {
      background-color: #b62020;
      outline: none;
    }

    /* Responsive */
    @media (max-width: 1000px) {
      .container {
        flex-direction: column;
        padding: 0 15px;
      }
      aside#filterSidebar {
        width: 100%;
        margin-bottom: 30px;
      }
      .gallery {
        width: 100%;
        flex-direction: row;
        overflow-x: auto;
      }
      .gallery #mainImage {
        width: 100%;
        max-height: 240px;
        border-radius: 12px;
        cursor: zoom-in;
      }
      .gallery .thumbs {
        justify-content: start;
      }
      .gallery .thumbs img {
        width: 80px;
        height: 54px;
      }
      .listing {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <header class="top-header">
    <div class="logo" onclick="window.location.href='index.html'">
      <img src="https://i.ibb.co/tdfVWT7/file-000000003fbc6243981f1c2e906b6319.png" alt="Torque Bay Logo" />
    </div>
  </header>

  <nav>
    <a href="index.html" class="active">Home</a>
    <a href="register.html">Register</a>
    <a href="login.html">Login</a>
    <a href="about.html">About Us</a>
    <a href="contact.html">Contact Us</a>
  </nav>

  <h1 class="welcome-text">Welcome to Torque Bay</h1>

  <div class="container">
    <aside id="filterSidebar" aria-label="Filter listings">
      <h3>Filter Listings</h3>
      <form id="filterForm">
        <label for="filterStatus">Condition</label>
        <select id="filterStatus" name="condition">
          <option value="">All</option>
          <option value="runner">Runner</option>
          <option value="not-runner">Not Runner</option>
        </select>

        <label for="filterBrand">Brand</label>
        <select id="filterBrand" name="brand">
          <option value="">All</option>
          <option value="Astra">Astra</option>
          <option value="BMW">BMW</option>
          <option value="Ford">Ford</option>
          <option value="Vauxhall">Vauxhall</option>
          <option value="Volkswagen">Volkswagen</option>
        </select>

        <label for="filterModel">Model</label>
        <input type="text" id="filterModel" name="model" placeholder="Model (e.g. J)" />

        <label for="filterFuel">Fuel Type</label>
        <select id="filterFuel" name="fuelType">
          <option value="">All</option>
          <option value="Petrol">Petrol</option>
          <option value="Diesel">Diesel</option>
          <option value="Hybrid">Hybrid</option>
          <option value="Electric">Electric</option>
        </select>

        <label for="filterYearMin">Year (Min)</label>
        <input type="number" id="filterYearMin" name="yearMin" placeholder="From" min="1900" max="2050" />

        <label for="filterYearMax">Year (Max)</label>
        <input type="number" id="filterYearMax" name="yearMax" placeholder="To" min="1900" max="2050" />

        <label for="filterPriceMin">Price (Min £)</label>
        <input type="number" id="filterPriceMin" name="priceMin" placeholder="Min Bid" min="0" />

        <label for="filterPriceMax">Price (Max £)</label>
        <input type="number" id="filterPriceMax" name="priceMax" placeholder="Buy Now" min="0" />

        <button type="submit">Apply Filters</button>
        <button type="button" class="clear-btn" id="clearFiltersBtn">Clear Filters</button>
      </form>
    </aside>

    <main id="listingsContainer" aria-live="polite" aria-relevant="additions">
      <!-- Listings injected by JS -->
    </main>
  </div>

  <footer>
    &copy; 2025 Torque Bay. All rights reserved.
  </footer>

  <!-- Contact Seller Modal -->
  <dialog id="contactModal" aria-modal="true" role="dialog" aria-labelledby="contactModalTitle" aria-describedby="contactModalDesc">
    <h2 id="contactModalTitle">Contact Seller</h2>
    <form id="contactForm">
      <label for="contactName">Your Name</label>
      <input type="text" id="contactName" name="contactName" required placeholder="Enter your name" />
      <label for="contactPhone">Your Phone Number</label>
      <input type="tel" id="contactPhone" name="contactPhone" required placeholder="e.g. +447123456789" />
      <button type="submit">Send WhatsApp Message</button>
      <button type="button" id="contactCancelBtn" style="margin-top:10px; background:#555;">Cancel</button>
    </form>
  </dialog>

  <script>
    // Listings data with updated Astra J images & live/dummy distinction
    const listings = [
      {
        id: 1,
        title: 'Astra J 1.4 Turbo 2010 A14NET',
        brand: 'Astra',
        model: 'J',
        year: 2010,
        condition: 'runner',
        fuelType: 'Petrol',
        miles: 89905,
        priceMinBid: 750,
        priceBuyNow: 1850,
        auctionEnd: new Date(Date.UTC(2025, 6, 30, 23, 59, 59)),
        description: 'The 2010 Astra J 1.4 Turbo features a 1.4L turbocharged petrol engine producing 138bhp and 200Nm of torque. Well maintained with a clean interior, low mileage, and an MOT valid until October 2025.',
        images: [
          "https://i.ibb.co/5x4fty6V/2025-07-05-18-30-25-401.jpg",
          "https://i.ibb.co/20LT3MMB/2025-07-05-18-30-42-743.jpg",
          "https://i.ibb.co/k692dv4t/2025-07-05-18-31-00-391.jpg",
          "https://i.ibb.co/PzPSzjVq/2025-07-05-18-31-07-371.jpg"
        ],
        whatsappNumber: "+447700900123",
        live: true,
        userCanBid: true
      },
      // Dummy ended listings
      {
        id: 2,
        title: 'BMW 320d E90 M47',
        brand: 'BMW',
        model: '320d',
        year: 2012,
        condition: 'runner',
        fuelType: 'Diesel',
        miles: 125000,
        priceMinBid: 1200,
        priceBuyNow: 2300,
        auctionEnd: new Date(Date.UTC(2024, 0, 15, 23, 59, 59)),
        description: 'BMW 320d with M47 engine, stage 1 remap, EGR off, swirl flaps deleted, straight pipe exhaust. A solid runner with a great history.',
        images: [
          "https://via.placeholder.com/280x160?text=BMW+320d+Front",
          "https://via.placeholder.com/280x160?text=BMW+320d+Side",
          "https://via.placeholder.com/280x160?text=BMW+320d+Interior"
        ],
        whatsappNumber: "+447700900124",
        live: false,
        userCanBid: false
      },
      {
        id: 3,
        title: 'Ford Fiesta MK7 2011',
        brand: 'Ford',
        model: 'Fiesta',
        year: 2011,
        condition: 'not-runner',
        fuelType: 'Petrol',
        miles: 130000,
        priceMinBid: 300,
        priceBuyNow: 600,
        auctionEnd: new Date(Date.UTC(2024, 1, 10, 23, 59, 59)),
        description: 'Ford Fiesta MK7 with 1.25L petrol engine, needs work but great project car.',
        images: [
          "https://via.placeholder.com/280x160?text=Ford+Fiesta+Front",
          "https://via.placeholder.com/280x160?text=Ford+Fiesta+Side",
          "https://via.placeholder.com/280x160?text=Ford+Fiesta+Interior"
        ],
        whatsappNumber: "+447700900125",
        live: false,
        userCanBid: false
      }
    ];

    // Cached elements
    const listingsContainer = document.getElementById('listingsContainer');
    const filterForm = document.getElementById('filterForm');
    const clearFiltersBtn = document.getElementById('clearFiltersBtn');
    const contactModal = document.getElementById('contactModal');
    const contactForm = document.getElementById('contactForm');
    const contactCancelBtn = document.getElementById('contactCancelBtn');

    let currentContactListing = null;

    // Render listings based on filters
    function renderListings(filter = {}) {
      listingsContainer.innerHTML = '';

      // Filter logic
      const filtered = listings.filter(listing => {
        if (filter.condition && filter.condition !== '' && listing.condition !== filter.condition) {
          return false;
        }
        if (filter.brand && filter.brand !== '' && listing.brand.toLowerCase() !== filter.brand.toLowerCase()) {
          return false;
        }
        if (filter.model && filter.model !== '' && !listing.model.toLowerCase().includes(filter.model.toLowerCase())) {
          return false;
        }
        if (filter.fuelType && filter.fuelType !== '' && listing.fuelType.toLowerCase() !== filter.fuelType.toLowerCase()) {
          return false;
        }
        if (filter.yearMin && filter.yearMin !== '' && listing.year < parseInt(filter.yearMin)) {
          return false;
        }
        if (filter.yearMax && filter.yearMax !== '' && listing.year > parseInt(filter.yearMax)) {
          return false;
        }
        if (filter.priceMin && filter.priceMin !== '' && listing.priceMinBid < parseInt(filter.priceMin)) {
          return false;
        }
        if (filter.priceMax && filter.priceMax !== '' && listing.priceBuyNow > parseInt(filter.priceMax)) {
          return false;
        }
        return true;
      });

      if (filtered.length === 0) {
        listingsContainer.innerHTML = `<p style="color:#eee; font-size:1.3rem; text-align:center; user-select:none;">No listings found with current filters.</p>`;
        return;
      }

      filtered.forEach(listing => {
        const ended = new Date() > listing.auctionEnd || !listing.live;

        const listingEl = document.createElement('article');
        listingEl.className = 'listing' + (ended ? ' ended' : '');
        listingEl.setAttribute('tabindex', '0');

        listingEl.innerHTML = `
          <div class="gallery" aria-label="Images of ${listing.title}">
            <img src="${listing.images[0]}" alt="${listing.title} main image" id="mainImage-${listing.id}" />
            <div class="thumbs" role="list" aria-label="Thumbnail images">
              ${listing.images.map((img, i) =>
                `<img src="${img}" alt="${listing.title} image ${i + 1}" role="listitem" tabindex="0" data-listingid="${listing.id}" data-index="${i}" class="${i === 0 ? 'selected' : ''}" />`
              ).join('')}
            </div>
          </div>
          <div class="details">
            <h2>${listing.title}</h2>
            <div class="badges">
              <div class="badge ${listing.condition === 'runner' ? '' : 'not-runner'}" aria-label="Condition: ${listing.condition}">
                ${listing.condition === 'runner' ? 'Runner' : 'Not Runner'}
              </div>
              <div class="badge">Year: ${listing.year}</div>
              <div class="badge">Fuel: ${listing.fuelType}</div>
              <div class="badge">Miles: ${listing.miles.toLocaleString()}</div>
            </div>

            <div id="auctionEnds">${ended ? '<strong>Auction Ended</strong>' : 'Auction Ends: ' + listing.auctionEnd.toUTCString()}</div>

            <p class="description">${listing.description}</p>

            <div class="actions">
              <label for="bidAmount-${listing.id}">Bid Amount (min £${listing.priceMinBid})</label>
              <input type="number" id="bidAmount-${listing.id}" name="bidAmount" min="${listing.priceMinBid}" step="1" placeholder="Enter bid amount" ${ended ? 'disabled' : ''} />
              <button id="bidBtn-${listing.id}" ${ended ? 'disabled' : ''}>Place Bid</button>

              <button id="buyNowBtn-${listing.id}" ${ended ? 'disabled' : ''}>Buy It Now £${listing.priceBuyNow}</button>

              ${
                listing.live
                  ? `<button id="contactSellerBtn-${listing.id}" data-whatsapp="${listing.whatsappNumber}">Contact Seller</button>`
                  : `<button disabled style="background:#555; cursor:not-allowed;">Auction Ended</button>`
              }
            </div>
          </div>
        `;

        listingsContainer.appendChild(listingEl);
      });

      setupGalleryClicks();
      setupButtons();
    }

    // Setup gallery thumbnails click
    function setupGalleryClicks() {
      const thumbs = document.querySelectorAll('.thumbs img');
      thumbs.forEach(thumb => {
        thumb.addEventListener('click', () => {
          const listingId = thumb.getAttribute('data-listingid');
          const mainImg = document.getElementById(`mainImage-${listingId}`);
          if (!mainImg) return;

          mainImg.src = thumb.src;

          // Update selected class
          const siblings = thumb.parentElement.querySelectorAll('img');
          siblings.forEach(s => s.classList.remove('selected'));
          thumb.classList.add('selected');
        });
        // keyboard accessible
        thumb.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            thumb.click();
          }
        });
      });

      // Zoom toggle on main image
      document.querySelectorAll('.gallery #mainImage').forEach(img => {
        img.addEventListener('click', () => {
          img.classList.toggle('zoomed');
        });
      });
    }

    // Setup bid, buy now and contact buttons
    function setupButtons() {
      listings.forEach(listing => {
        const ended = new Date() > listing.auctionEnd || !listing.live;
        if (ended) return;

        // Bid button
        const bidBtn = document.getElementById(`bidBtn-${listing.id}`);
        const bidInput = document.getElementById(`bidAmount-${listing.id}`);
        if (bidBtn && bidInput) {
          bidBtn.addEventListener('click', () => {
            const bidValue = parseInt(bidInput.value);
            if (isNaN(bidValue) || bidValue < listing.priceMinBid) {
              alert(`Please enter a valid bid amount at least £${listing.priceMinBid}`);
              return;
            }
            alert(`Bid of £${bidValue} placed on ${listing.title}. (Demo only)`);
          });
        }

        // Buy now button
        const buyBtn = document.getElementById(`buyNowBtn-${listing.id}`);
        if (buyBtn) {
          buyBtn.addEventListener('click', () => {
            alert(`You have bought the ${listing.title} for £${listing.priceBuyNow}. (Demo only)`);
          });
        }

        // Contact seller button (Whatsapp integration)
        const contactBtn = document.getElementById(`contactSellerBtn-${listing.id}`);
        if (contactBtn) {
          contactBtn.addEventListener('click', () => {
            currentContactListing = listing;
            contactModal.showModal();
          });
        }
      });
    }

    // Filter form submit
    filterForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(filterForm);
      const filters = {};
      for (const [key, value] of formData.entries()) {
        filters[key] = value.trim();
      }
      renderListings(filters);
    });

    // Clear filters
    clearFiltersBtn.addEventListener('click', () => {
      filterForm.reset();
      renderListings();
    });

    // Contact modal cancel button
    contactCancelBtn.addEventListener('click', () => {
      contactModal.close();
      currentContactListing = null;
    });

    // Contact form submit - open WhatsApp link
    contactForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!currentContactListing) {
        alert('No listing selected.');
        contactModal.close();
        return;
      }
      const name = document.getElementById('contactName').value.trim();
      const phone = document.getElementById('contactPhone').value.trim();
      if (!name || !phone) {
        alert('Please fill in all fields.');
        return;
      }
      // WhatsApp message encode
      const message = encodeURIComponent(
        `Hello, I am ${name}. I am interested in your listing: ${currentContactListing.title}. Please contact me at ${phone}.`
      );
      const whatsappUrl = `https://wa.me/${currentContactListing.whatsappNumber.replace(/\D/g,'')}?text=${message}`;
      window.open(whatsappUrl, '_blank');
      contactModal.close();
      currentContactListing = null;
      contactForm.reset();
    });

    // Initial render
    renderListings();
  </script>
</body>
</html>
