<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Torque Bay</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      padding: 1rem;
      max-width: 1000px;
      margin: auto;
      background: #111;
      color: #fff;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      font-size: 14px;
      line-height: 1.4;
    }

    img {
      max-width: 100%;
      display: block;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-container img {
      height: 70px; /* bigger logo */
    }

    .auth-buttons a {
      color: #d32f2f;
      text-decoration: none;
      font-weight: 700;
      margin-left: 15px;
      border: 2px solid #d32f2f;
      padding: 6px 12px;
      border-radius: 5px;
      transition: background-color 0.3s ease;
      font-size: 0.9rem;
    }
    .auth-buttons a:hover {
      background-color: #d32f2f;
      color: #fff;
    }

    .rolling-text-container {
      overflow: hidden;
      white-space: nowrap;
      border-top: 3px solid #d32f2f;
      border-bottom: 3px solid #d32f2f;
      margin: 1rem 0 1rem 0;
      padding: 10px 0;
    }
    .rolling-text {
      display: inline-block;
      padding-left: 100%;
      animation: scroll 15s linear infinite;
      color: #d32f2f;
      font-weight: 700;
      font-size: 1rem;
    }
    @keyframes scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    #auctionEnds {
      position: relative;
      margin-bottom: 1rem;
      font-weight: 900;
      color: #fff;
      font-size: 1.1rem;
      text-align: right;
      user-select: none;
      text-shadow: 0 0 5px #000;
    }

    main.container {
      role: main;
      ariaLabel: "Car auction and sales listings";
    }

    /* Hide filters if only 1 listing */
    #filtersForm {
      display: none;
      margin-bottom: 20px;
      color: #fff;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    article.listing {
      border: 1px solid #444;
      border-radius: 8px;
      background: #222;
      padding: 15px;
      margin-bottom: 25px;
      box-shadow: 0 0 10px rgba(211, 47, 47, 0.3);
      display: flex;
      gap: 20px;
      flex-wrap: nowrap;
      position: relative;
      align-items: flex-start;
      font-size: 14px;
    }

    article.listing h3 {
      margin-top: 0;
      color: #d32f2f;
      font-size: 1.4rem;
      flex-basis: 100%;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #4caf50;
      font-weight: 600;
      margin-bottom: 5px;
    }
    .tag svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    .gallery {
      flex: 0 0 220px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 220px;
    }

    .gallery img {
      border-radius: 6px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.3s ease;
      max-height: 110px;
      object-fit: cover;
    }

    .gallery img.selected {
      border-color: #d32f2f;
    }

    .main-image-container {
      flex: 0 0 400px;
      max-width: 400px;
      position: relative;
    }

    #mainImage {
      border-radius: 8px;
      cursor: zoom-in;
      transition: transform 0.3s ease;
      object-fit: contain;
      max-height: 300px;
      width: 100%;
      display: block;
    }

    #mainImage.zoomed {
      cursor: zoom-out;
      transform: scale(2);
      z-index: 10;
      position: relative;
    }

    .info-section {
      flex: 1 1 320px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      gap: 15px;
      color: #fff;
      max-width: 320px;
      min-width: 280px;
    }

    .price {
      font-size: 1.6rem;
      font-weight: 900;
      color: #ff6f00; /* orange */
      margin: 0;
      letter-spacing: 1.5px;
      text-align: center;
      text-shadow: none;
    }

    .actions button,
    .actions input[type="number"],
    .actions label {
      display: block;
      width: 100%;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .actions button {
      cursor: pointer;
      padding: 10px;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
      font-weight: 700;
      transition: background-color 0.3s ease;
    }

    .buy-now-price {
      background-color: #ff6f00;
      color: white;
    }
    .buy-now-price:hover {
      background-color: #e65c00;
    }

    #bidAmount {
      padding: 8px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #444;
      background: #222;
      color: #fff;
      box-sizing: border-box;
    }

    #bidBtn {
      background-color: #4caf50;
      color: white;
      border: none;
    }
    #bidBtn:hover {
      background-color: #388e3c;
    }

    .contact-seller {
      background-color: #388e3c;
      color: white;
      border: none;
      font-weight: 700;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .contact-seller:hover {
      background-color: #2e7031;
    }

    .description {
      margin-top: 15px;
      line-height: 1.4;
      font-size: 0.9rem;
      color: #ddd;
      flex-grow: 1;
      max-height: 140px;
      overflow-y: auto;
      padding-right: 5px;
    }

    footer {
      margin-top: auto;
      text-align: center;
      padding: 1rem 0;
      font-size: 0.85rem;
      color: #666;
      border-top: 1px solid #333;
    }

    /* Responsive */
    @media (max-width: 850px) {
      #auctionEnds {
        position: static;
        margin-bottom: 1rem;
        text-align: center;
      }
      article.listing {
        flex-direction: column;
        align-items: center;
      }
      .gallery {
        max-width: 100%;
        flex-direction: row;
        overflow-x: auto;
      }
      .gallery img {
        max-width: 100px;
        max-height: 80px;
      }
      .main-image-container,
      .info-section,
      .description {
        max-width: 100%;
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <header role="banner" aria-label="Site header with logo and authentication">
    <div class="logo-container">
      <img src="https://i.ibb.co/gL9ttQ1k/logo.jpg" alt="Torque Bay Logo" />
      <h1 style="font-size:1.6rem; margin:0; user-select:none;">Torque Bay â€“ Car Auctions & Sales</h1>
    </div>
    <nav class="auth-buttons" aria-label="User authentication actions">
      <a href="login.html" id="loginLink">Login</a>
      <a href="register.html" id="registerLink">Register</a>
    </nav>
  </header>

  <div class="rolling-text-container" aria-live="polite" aria-atomic="true" role="region" aria-label="Site updates scrolling message">
    <div class="rolling-text">
      ðŸš— Updates coming soon! â€“ Email TorqueBay@gmail.com for enquiries & membership info. Stay tuned! ðŸš€
    </div>
  </div>

  <div id="auctionEnds" aria-live="polite" aria-atomic="true">Auction Ends In: 23h 59m 59s</div>

  <main class="container" role="main" aria-label="Car auction and sales listings">

    <!-- Filters hidden for single listing -->

    <div id="listingsContainer" aria-live="polite" aria-atomic="true">
      <!-- Listings will be injected here -->
    </div>
  </main>

  <!-- Contact Modal -->
  <dialog id="contactModal" aria-modal="true" role="dialog" aria-labelledby="contactModalTitle">
    <form id="contactForm">
      <h2 id="contactModalTitle">Contact Seller</h2>
      <p>Please enter your phone number and we will contact you shortly regarding the listing.</p>
      <label for="phoneNumber">Phone Number:</label><br />
      <input type="tel" id="phoneNumber" name="phoneNumber" placeholder="+44 7000 000000" required autocomplete="tel" /><br /><br />
      <button type="submit">Send</button>
      <button type="button" id="closeContactModalBtn">Cancel</button>
    </form>
  </dialog>

  <script>
    const listingsData = [
      {
        id: '1',
        title: 'Vauxhall Astra J 1.4 Turbo 2010',
        model: 'Astra',
        condition: 'runner',
        mileage: 89905,
        price: 1999,
        buyNowPrice: 1999,
        description: 'Powered by a 1.4L turbocharged petrol engine delivering approximately 138 bhp with great fuel efficiency of around 45 mpg (combined). Ideal for city driving and longer trips, with smooth ride and agile handling. Perfect for reliable and affordable performance.',
        images: [
          'https://i.ibb.co/5x4fty6V/2025-07-05-18-30-25-401.jpg',
          'https://i.ibb.co/20LT3MMB/2025-07-05-18-30-42-743.jpg',
          'https://i.ibb.co/k692dv4t/2025-07-05-18-31-00-391.jpg',
          'https://i.ibb.co/PzPSzjVq/2025-07-05-18-31-07-371.jpg',
        ],
      }
    ];

    let token = localStorage.getItem('token');

    const listingsContainer = document.getElementById('listingsContainer');
    const auctionEndsEl = document.getElementById('auctionEnds');

    // Format numbers with commas
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    // Render single listing
    function renderListing(listing) {
      listingsContainer.innerHTML = '';
      const listingEl = document.createElement('article');
      listingEl.className = 'listing';
      listingEl.setAttribute('tabindex', '0');
      listingEl.innerHTML = `
        <h3>${listing.title}</h3>
        <div class="gallery" aria-label="Image gallery for ${listing.title}">
          ${listing.images.map((img, i) => `<img src="${img}" alt="${listing.title} image ${i+1}" ${i === 0 ? 'class="selected"' : ''} tabindex="0" />`).join('')}
        </div>
        <div class="main-image-container">
          <img id="mainImage-${listing.id}" class="main-image" src="${listing.images[0]}" alt="${listing.title} main image" tabindex="0" />
        </div>
        <section class="info-section" aria-label="Details for ${listing.title}">
          <p class="tag" aria-label="Car condition">${listing.condition === 'runner' ? 
            '<svg aria-hidden="true" viewBox="0 0 24 24" focusable="false"><path d="M9 16.2l-3.5-3.5L4 14l5 5 12-12-1.5-1.5z"/></svg> Runner' 
            : 'Non-runner'}</p>
          <p class="price" aria-label="Price Â£${formatNumber(listing.price)}">Â£${formatNumber(listing.price)}</p>
          <p class="description">${listing.description}</p>
          <p><strong>Mileage:</strong> ${formatNumber(listing.mileage)} miles</p>

          <div class="actions" aria-label="Actions for ${listing.title}">
            <form class="bid-form" aria-label="Place a bid on ${listing.title}">
              <label for="bidAmount-${listing.id}">Your Bid (Â£):</label>
              <input type="number" min="${listing.price + 1}" id="bidAmount-${listing.id}" name="bidAmount" placeholder="Â£${listing.price + 1}" required />
              <button type="submit" id="bidBtn-${listing.id}">Place Bid</button>
            </form>
            <button class="buy-now-price" id="buyNowBtn-${listing.id}">Buy It Now Â£${formatNumber(listing.buyNowPrice)}</button>
            <button class="contact-seller" id="contactSellerBtn-${listing.id}">Contact Seller</button>
          </div>
        </section>
      `;

      listingsContainer.appendChild(listingEl);

      // Gallery images click
      const galleryImgs = listingEl.querySelectorAll('.gallery img');
      const mainImg = listingEl.querySelector(`#mainImage-${listing.id}`);
      galleryImgs.forEach(img => {
        img.addEventListener('click', () => {
          galleryImgs.forEach(i => i.classList.remove('selected'));
          img.classList.add('selected');
          mainImg.src = img.src;
          mainImg.alt = img.alt;
        });
        img.addEventListener('keydown', e => {
          if(e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            img.click();
          }
        });
      });

      // Main image zoom toggle
      mainImg.addEventListener('click', () => {
        mainImg.classList.toggle('zoomed');
      });

      // Bid form handler
      const bidForm = listingEl.querySelector('.bid-form');
      bidForm.addEventListener('submit', e => {
        e.preventDefault();
        if(!token) {
          alert('You must be logged in to place a bid. Please login or register.');
          return;
        }
        const bidInput = bidForm.bidAmount;
        const bidVal = Number(bidInput.value);
        if(bidVal <= listing.price) {
          alert(`Bid must be greater than the current price (Â£${listing.price}).`);
          return;
        }
        alert(`Your bid of Â£${formatNumber(bidVal)} has been placed!`);
        bidForm.reset();
      });

      // Buy now button handler
      const buyNowBtn = listingEl.querySelector(`#buyNowBtn-${listing.id}`);
      buyNowBtn.addEventListener('click', () => {
        if(!token) {
          alert('You must be logged in to buy the car now. Please login or register.');
          return;
        }
        if(confirm(`Are you sure you want to buy ${listing.title} now for Â£${formatNumber(listing.buyNowPrice)}?`)){
          alert('Congratulations! You have purchased the car. The seller will contact you shortly.');
        }
      });

      // Contact seller handler
      const contactSellerBtn = listingEl.querySelector(`#contactSellerBtn-${listing.id}`);
      contactSellerBtn.addEventListener('click', () => {
        currentListingId = listing.id;
        contactModal.showModal();
        document.getElementById('phoneNumber').focus();
      });
    }

    // Render the single listing Astra
    renderListing(listingsData[0]);

    // Auction countdown timer
    let countdownTime = 24 * 60 * 60; // 24h in seconds
    const auctionEndsEl = document.getElementById('auctionEnds');

    function updateCountdown() {
      if(countdownTime <= 0) {
        auctionEndsEl.textContent = 'Auction Ended';
        clearInterval(countdownInterval);
        return;
      }
      const hrs = Math.floor(countdownTime / 3600);
      const mins = Math.floor((countdownTime % 3600) / 60);
      const secs = countdownTime % 60;
      auctionEndsEl.textContent = `Auction Ends In: ${hrs}h ${mins}m ${secs}s`;
      countdownTime--;
    }
    updateCountdown();
    const countdownInterval = setInterval(updateCountdown, 1000);

    // Contact seller modal logic
    const contactModal = document.getElementById('contactModal');
    const contactForm = document.getElementById('contactForm');
    const closeContactModalBtn = document.getElementById('closeContactModalBtn');
    let currentListingId = null;

    closeContactModalBtn.addEventListener('click', () => {
      contactModal.close();
      contactForm.reset();
    });

    contactForm.addEventListener('submit', e => {
      e.preventDefault();
      const phoneNumber = contactForm.phoneNumber.value.trim();
      if(phoneNumber.length < 6) {
        alert('Please enter a valid phone number.');
        return;
      }
      // Here: send phoneNumber and currentListingId to backend or API
      alert(`Thank you! We will contact you shortly at ${phoneNumber} regarding listing ID: ${currentListingId}.`);
      contactForm.reset();
      contactModal.close();
    });
  </script>

  <footer>
    TorqueBay 2025 All Rights Reserved &copy;
  </footer>
</body>
</html>
